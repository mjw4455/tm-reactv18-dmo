import{j as e}from"./index.CpG82mxC.js";import{F as n,r,f as _,g as b,T as S,h as k,s as w,B as p,S as F,i as L,j as M}from"./ui-lib.Bnf-PDlM.js";import{a as m}from"./index.-GBhP27z.js";import{h as D}from"./moment.C5S46NFB.js";import"./framework.DeqkGhWy.js";import"./utils.t--hEgTQ.js";const T="_action_15r4w_1",v={action:T};function Y(d){const[l]=n.useForm(),[h,c]=r.useState(""),[x,j]=r.useState(),[f,y]=r.useState([]),[g,u]=r.useState(!1),o=async()=>{try{const t=await m.getUserList();y(t.data.data.list)}catch(t){console.log(t)}},N=async()=>{l.validateFields().then(async t=>{let I=null;try{h==="add"?(I=await m.createDept(t),w.success({content:"添加成功"})):(I=await m.updateDept(t),I.data.code==200&&w.success({content:"修改成功"})),d.getDeptList()}catch(C){console.error(C)}u(!1)})},a=()=>{u(!1)},s=t=>{c(t==null?void 0:t.edit),u(!0),l.resetFields(),typeof t=="object"&&(t.edit=="edit"&&l.setFieldsValue({_id:t._id,parentId:t.parentId,deptName:t.deptName,userName:t.userName}),t.edit=="add"&&l.setFieldsValue({parentId:t._id}))},i=t=>{j(t)};return r.useImperativeHandle(d.mref,()=>({openModal:s})),r.useEffect(()=>{o()},[]),e.jsx(e.Fragment,{children:e.jsx(_,{title:h==="add"?"添加部门":"编辑部门",width:800,cancelText:"取消",okText:"确定",open:g,onOk:N,onCancel:a,children:e.jsxs(n,{labelAlign:"right",labelCol:{span:4},form:l,children:[e.jsx(n.Item,{hidden:!0,label:"_id",name:"_id",children:e.jsx(b,{disabled:!0})}),e.jsx(n.Item,{label:"上级部门",name:"parentId",children:e.jsx(S,{showSearch:!0,style:{width:"100%"},value:x,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"Please select",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"deptName",value:"_id"},treeData:d.deptList,onChange:i})}),e.jsx(n.Item,{label:"部门名称",name:"deptName",rules:[{required:!0,message:"请输入部门名称"}],children:e.jsx(b,{placeholder:"请输入部门名称"})}),e.jsx(n.Item,{label:"负责人",name:"userName",rules:[{required:!0,message:"请选择负责人"}],children:e.jsx(k,{placeholder:"请选择负责人",children:f.map(t=>e.jsx(k.Option,{value:t.userName,children:t.userName},t.userId))})})]})})})}const{confirm:E}=_;function q(){const d=r.useRef(null),[l]=n.useForm(),[h,c]=r.useState(!1),[x,j]=r.useState([]),f=a=>{var i;let s={edit:"add",...a};(i=d.current)==null||i.openModal(s)},y=a=>{var i;let s={edit:"edit",...a};(i=d.current)==null||i.openModal(s)},g=a=>{E({title:"是否执行该操作?",icon:e.jsx(M,{}),content:"删除该部门将无法恢复，请谨慎操作!",okText:"确定",cancelText:"取消",centered:!0,async onOk(){c(!0);try{(await m.deleteDept(a)).data.code==200&&(w.success({content:"删除成功"}),o())}catch{}c(!1)},onCancel(){}})},u=[{title:"部门名称",dataIndex:"deptName",key:"_id",width:"20%"},{title:"创建时间",dataIndex:"createTime",key:"_id",render:a=>D(a).format("YYYY-MM-DD HH:mm:ss")},{title:"更新时间",dataIndex:"updateTime",key:"_id",render:a=>D(a).format("YYYY-MM-DD HH:mm:ss")},{title:"负责人",dataIndex:"userName",key:"_id"},{title:"操作",dataIndex:"action",width:250,render:(a,s)=>e.jsxs("div",{className:v.action,children:[e.jsx(p,{type:"primary",onClick:()=>f(s),children:"新增"}),e.jsx(p,{type:"primary",onClick:()=>y(s),children:"编辑"}),e.jsx(p,{danger:!0,onClick:()=>g(s._id),children:"删除"})]})}],o=async()=>{try{c(!0);const a=await m.getDept({deptName:l.getFieldValue("deptName")});j(a.data.data)}catch(a){console.log(a)}finally{c(!1)}},N=()=>{l.resetFields()};return r.useEffect(()=>{o()},[]),e.jsxs("div",{className:"wrap-table",children:[e.jsxs(n,{className:"search-form",layout:"inline",form:l,children:[e.jsx(n.Item,{label:"部门名称",name:"deptName",children:e.jsx(b,{placeholder:"请输入部门名称"})}),e.jsxs(n.Item,{label:null,children:[e.jsx(p,{type:"primary",htmlType:"submit",onClick:o,children:"查询"}),e.jsx("span",{style:{marginLeft:"10px"},children:e.jsx(p,{type:"primary",htmlType:"submit",onClick:N,children:"重置"})})]})]}),e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"title",children:"部门列表"}),e.jsx("div",{className:"action",children:e.jsx(p,{type:"primary",onClick:()=>f(),children:"新增"})})]}),e.jsx(F,{tip:"加载中...",spinning:h,children:e.jsx(L,{rowKey:"_id",columns:u,dataSource:x})}),e.jsx(Y,{mref:d,deptList:x,getDeptList:o})]})}export{q as default};
