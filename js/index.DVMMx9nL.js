import{j as p,A as Se}from"./index.CpG82mxC.js";import{F as M,r as g,f as Te,g as Q,s as je,k as Ze,B,S as er,i as rr,j as tr}from"./ui-lib.Bnf-PDlM.js";import{h as _e}from"./moment.C5S46NFB.js";import{a as Pe}from"./index.-GBhP27z.js";import{c as J,g as Ve}from"./framework.DeqkGhWy.js";import"./utils.t--hEgTQ.js";const nr="_action_15r4w_1",ar={action:nr};function ir(t){const[e]=M.useForm(),[r,n]=g.useState(""),[i,u]=g.useState(!1),o=async()=>{e.validateFields().then(async a=>{let d=null;try{r==="add"?(d=await Pe.createDept(a),je.success({content:"添加成功"})):(d=await Pe.updateDept(a),d.data.code==200&&je.success({content:"修改成功"}))}catch(f){console.error(f)}u(!1)})},c=()=>{u(!1)},s=a=>{n(a==null?void 0:a.edit),u(!0),e.resetFields(),typeof a=="object"&&(a.edit=="edit"&&e.setFieldsValue({_id:a._id,roleName:a.roleName,remark:a.remark}),a.edit=="add"&&e.setFieldsValue({_id:a._id}))};return g.useImperativeHandle(t.mref,()=>({openModal:s})),p.jsx(p.Fragment,{children:p.jsx(Te,{title:r==="add"?"新增角色":"编辑角色",width:800,cancelText:"取消",okText:"确定",open:i,onOk:o,onCancel:c,children:p.jsxs(M,{labelAlign:"right",labelCol:{span:4},form:e,children:[p.jsx(M.Item,{hidden:!0,label:"_id",name:"_id",children:p.jsx(Q,{disabled:!0})}),p.jsx(M.Item,{label:"角色名称",name:"roleName",rules:[{required:!0,message:"请输入角色名称"}],children:p.jsx(Q,{placeholder:"请输入角色名称"})}),p.jsx(M.Item,{label:"备注",name:"remark",children:p.jsx(Q.TextArea,{placeholder:"请输入备注"})})]})})})}var ur=function(t){return function(e,r){var n=g.useRef(!1);t(function(){return function(){n.current=!1}},[]),t(function(){if(!n.current)n.current=!0;else return e()},r)}},y=function(){return y=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(e[u]=r[u])}return e},y.apply(this,arguments)};function re(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function or(t,e,r,n){function i(u){return u instanceof r?u:new r(function(o){o(u)})}return new(r||(r=Promise))(function(u,o){function c(d){try{a(n.next(d))}catch(f){o(f)}}function s(d){try{a(n.throw(d))}catch(f){o(f)}}function a(d){d.done?u(d.value):i(d.value).then(c,s)}a((n=n.apply(t,e||[])).next())})}function sr(t,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,i,u,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(d){return s([a,d])}}function s(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(r=0)),r;)try{if(n=1,i&&(u=a[0]&2?i.return:a[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,a[1])).done)return u;switch(i=0,u&&(a=[a[0]&2,u.value]),a[0]){case 0:case 1:u=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!u||a[1]>u[0]&&a[1]<u[3])){r.label=a[1];break}if(a[0]===6&&r.label<u[1]){r.label=u[1],u=a;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(a);break}u[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(d){a=[6,d],i=0}finally{n=u=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function T(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,u=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)u.push(i.value)}catch(c){o={error:c}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return u}function R(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,u;n<i;n++)(u||!(n in e))&&(u||(u=Array.prototype.slice.call(e,0,n)),u[n]=e[n]);return t.concat(u||Array.prototype.slice.call(e))}var cr=function(t){return typeof t=="function"};function k(t){var e=g.useRef(t);e.current=g.useMemo(function(){return t},[t]);var r=g.useRef();return r.current||(r.current=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return e.current.apply(this,n)}),r.current}const V=ur(g.useEffect);var Ge=function(t,e){var r=e.manual,n=e.ready,i=n===void 0?!0:n,u=e.defaultParams,o=u===void 0?[]:u,c=e.refreshDeps,s=c===void 0?[]:c,a=e.refreshDepsAction,d=g.useRef(!1);return d.current=!1,V(function(){!r&&i&&(d.current=!0,t.run.apply(t,R([],T(o),!1)))},[i]),V(function(){d.current||r||(d.current=!0,a?a():t.refresh())},R([],T(s),!1)),{onBefore:function(){if(!i)return{stopNow:!0}}}};Ge.onInit=function(t){var e=t.ready,r=e===void 0?!0:e,n=t.manual;return{loading:!n&&r}};function lr(t,e){if(t===e)return!0;for(var r=0;r<t.length;r++)if(!Object.is(t[r],e[r]))return!1;return!0}function Ye(t,e){var r=g.useRef({deps:e,obj:void 0,initialized:!1}).current;return(r.initialized===!1||!lr(r.deps,e))&&(r.deps=e,r.obj=t(),r.initialized=!0),r.obj}function Ue(t){var e=g.useRef(t);return e.current=t,e}var xe=function(t){var e=Ue(t);g.useEffect(function(){return function(){e.current()}},[])},Z=new Map,fr=function(t,e,r){var n=Z.get(t);n!=null&&n.timer&&clearTimeout(n.timer);var i=void 0;e>-1&&(i=setTimeout(function(){Z.delete(t)},e)),Z.set(t,y(y({},r),{timer:i}))},dr=function(t){return Z.get(t)},ee=new Map,vr=function(t){return ee.get(t)},mr=function(t,e){ee.set(t,e),e.then(function(r){return ee.delete(t),r}).catch(function(){ee.delete(t)})},H={},hr=function(t,e){H[t]&&H[t].forEach(function(r){return r(e)})},ae=function(t,e){return H[t]||(H[t]=[]),H[t].push(e),function(){var n=H[t].indexOf(e);H[t].splice(n,1)}},gr=function(t,e){var r=e.cacheKey,n=e.cacheTime,i=n===void 0?5*60*1e3:n,u=e.staleTime,o=u===void 0?0:u,c=e.setCache,s=e.getCache,a=g.useRef(),d=g.useRef(),f=function(v,l){c?c(l):fr(v,i,l),hr(v,l.data)},m=function(v,l){return l===void 0&&(l=[]),s?s(l):dr(v)};return Ye(function(){if(r){var v=m(r);v&&Object.hasOwnProperty.call(v,"data")&&(t.state.data=v.data,t.state.params=v.params,(o===-1||new Date().getTime()-v.time<=o)&&(t.state.loading=!1)),a.current=ae(r,function(l){t.setState({data:l})})}},[]),xe(function(){var v;(v=a.current)===null||v===void 0||v.call(a)}),r?{onBefore:function(v){var l=m(r,v);return!l||!Object.hasOwnProperty.call(l,"data")?{}:o===-1||new Date().getTime()-l.time<=o?{loading:!1,data:l==null?void 0:l.data,error:void 0,returnNow:!0}:{data:l==null?void 0:l.data,error:void 0}},onRequest:function(v,l){var h=vr(r);return h&&h!==d.current?{servicePromise:h}:(h=v.apply(void 0,R([],T(l),!1)),d.current=h,mr(r,h),{servicePromise:h})},onSuccess:function(v,l){var h;r&&((h=a.current)===null||h===void 0||h.call(a),f(r,{data:v,params:l,time:new Date().getTime()}),a.current=ae(r,function(j){t.setState({data:j})}))},onMutate:function(v){var l;r&&((l=a.current)===null||l===void 0||l.call(a),f(r,{data:v,params:t.state.params,time:new Date().getTime()}),a.current=ae(r,function(h){t.setState({data:h})}))}}:{}},ie,Oe;function Re(){if(Oe)return ie;Oe=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return ie=t,ie}var ue,Ce;function pr(){if(Ce)return ue;Ce=1;var t=typeof J=="object"&&J&&J.Object===Object&&J;return ue=t,ue}var oe,Fe;function $e(){if(Fe)return oe;Fe=1;var t=pr(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return oe=r,oe}var se,Ee;function br(){if(Ee)return se;Ee=1;var t=$e(),e=function(){return t.Date.now()};return se=e,se}var ce,Ie;function yr(){if(Ie)return ce;Ie=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return ce=e,ce}var le,ke;function Sr(){if(ke)return le;ke=1;var t=yr(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return le=r,le}var fe,Me;function Ke(){if(Me)return fe;Me=1;var t=$e(),e=t.Symbol;return fe=e,fe}var de,Ae;function jr(){if(Ae)return de;Ae=1;var t=Ke(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function u(o){var c=r.call(o,i),s=o[i];try{o[i]=void 0;var a=!0}catch{}var d=n.call(o);return a&&(c?o[i]=s:delete o[i]),d}return de=u,de}var ve,De;function Tr(){if(De)return ve;De=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return ve=r,ve}var me,Ne;function xr(){if(Ne)return me;Ne=1;var t=Ke(),e=jr(),r=Tr(),n="[object Null]",i="[object Undefined]",u=t?t.toStringTag:void 0;function o(c){return c==null?c===void 0?i:n:u&&u in Object(c)?e(c):r(c)}return me=o,me}var he,qe;function Rr(){if(qe)return he;qe=1;function t(e){return e!=null&&typeof e=="object"}return he=t,he}var ge,ze;function wr(){if(ze)return ge;ze=1;var t=xr(),e=Rr(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return ge=n,ge}var pe,Le;function _r(){if(Le)return pe;Le=1;var t=Sr(),e=Re(),r=wr(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,o=/^0o[0-7]+$/i,c=parseInt;function s(a){if(typeof a=="number")return a;if(r(a))return n;if(e(a)){var d=typeof a.valueOf=="function"?a.valueOf():a;a=e(d)?d+"":d}if(typeof a!="string")return a===0?a:+a;a=t(a);var f=u.test(a);return f||o.test(a)?c(a.slice(2),f?2:8):i.test(a)?n:+a}return pe=s,pe}var be,He;function Xe(){if(He)return be;He=1;var t=Re(),e=br(),r=_r(),n="Expected a function",i=Math.max,u=Math.min;function o(c,s,a){var d,f,m,v,l,h,j=0,F=!1,P=!1,O=!0;if(typeof c!="function")throw new TypeError(n);s=r(s)||0,t(a)&&(F=!!a.leading,P="maxWait"in a,m=P?i(r(a.maxWait)||0,s):m,O="trailing"in a?!!a.trailing:O);function E(x){var I=d,z=f;return d=f=void 0,j=x,v=c.apply(z,I),v}function A(x){return j=x,l=setTimeout(C,s),F?E(x):v}function w(x){var I=x-h,z=x-j,K=s-I;return P?u(K,m-z):K}function D(x){var I=x-h,z=x-j;return h===void 0||I>=s||I<0||P&&z>=m}function C(){var x=e();if(D(x))return N(x);l=setTimeout(C,w(x))}function N(x){return l=void 0,O&&d?E(x):(d=f=void 0,v)}function W(){l!==void 0&&clearTimeout(l),j=0,d=h=f=l=void 0}function G(){return l===void 0?v:N(e())}function q(){var x=e(),I=D(x);if(d=arguments,f=this,h=x,I){if(l===void 0)return A(h);if(P)return clearTimeout(l),l=setTimeout(C,s),E(h)}return l===void 0&&(l=setTimeout(C,s)),v}return q.cancel=W,q.flush=G,q}return be=o,be}var Pr=Xe();const Or=Ve(Pr);var Cr=function(t,e){var r=e.debounceWait,n=e.debounceLeading,i=e.debounceTrailing,u=e.debounceMaxWait,o=g.useRef(),c=g.useMemo(function(){var s={};return n!==void 0&&(s.leading=n),i!==void 0&&(s.trailing=i),u!==void 0&&(s.maxWait=u),s},[n,i,u]);return g.useEffect(function(){if(r){var s=t.runAsync.bind(t);return o.current=Or(function(a){a()},r,c),t.runAsync=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return new Promise(function(f,m){var v;(v=o.current)===null||v===void 0||v.call(o,function(){s.apply(void 0,R([],T(a),!1)).then(f).catch(m)})})},function(){var a;(a=o.current)===null||a===void 0||a.cancel(),t.runAsync=s}}},[r,c]),r?{onCancel:function(){var s;(s=o.current)===null||s===void 0||s.cancel()}}:{}},Fr=function(t,e){var r=e.loadingDelay,n=e.ready,i=g.useRef();if(!r)return{};var u=function(){i.current&&clearTimeout(i.current)};return{onBefore:function(){return u(),n!==!1&&(i.current=setTimeout(function(){t.setState({loading:!0})},r)),{loading:!1}},onFinally:function(){u()},onCancel:function(){u()}}},te=!!(typeof window<"u"&&window.document&&window.document.createElement);function we(){return te?document.visibilityState!=="hidden":!0}var U=[];function Er(t){return U.push(t),function(){var r=U.indexOf(t);U.splice(r,1)}}if(te){var Ir=function(){if(we())for(var t=0;t<U.length;t++){var e=U[t];e()}};window.addEventListener("visibilitychange",Ir,!1)}var kr=function(t,e){var r=e.pollingInterval,n=e.pollingWhenHidden,i=n===void 0?!0:n,u=e.pollingErrorRetryCount,o=u===void 0?-1:u,c=g.useRef(),s=g.useRef(),a=g.useRef(0),d=function(){var f;c.current&&clearTimeout(c.current),(f=s.current)===null||f===void 0||f.call(s)};return V(function(){r||d()},[r]),r?{onBefore:function(){d()},onError:function(){a.current+=1},onSuccess:function(){a.current=0},onFinally:function(){o===-1||o!==-1&&a.current<=o?c.current=setTimeout(function(){!i&&!we()?s.current=Er(function(){t.refresh()}):t.refresh()},r):a.current=0},onCancel:function(){d()}}:{}};function Mr(t,e){var r=!1;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];r||(r=!0,t.apply(void 0,R([],T(n),!1)),setTimeout(function(){r=!1},e))}}function Ar(){return te&&typeof navigator.onLine<"u"?navigator.onLine:!0}var $=[];function Dr(t){return $.push(t),function(){var r=$.indexOf(t);r>-1&&$.splice(r,1)}}if(te){var We=function(){if(!(!we()||!Ar()))for(var t=0;t<$.length;t++){var e=$[t];e()}};window.addEventListener("visibilitychange",We,!1),window.addEventListener("focus",We,!1)}var Nr=function(t,e){var r=e.refreshOnWindowFocus,n=e.focusTimespan,i=n===void 0?5e3:n,u=g.useRef(),o=function(){var c;(c=u.current)===null||c===void 0||c.call(u)};return g.useEffect(function(){if(r){var c=Mr(t.refresh.bind(t),i);u.current=Dr(function(){c()})}return function(){o()}},[r,i]),xe(function(){o()}),{}},qr=function(t,e){var r=e.retryInterval,n=e.retryCount,i=g.useRef(),u=g.useRef(0),o=g.useRef(!1);return n?{onBefore:function(){o.current||(u.current=0),o.current=!1,i.current&&clearTimeout(i.current)},onSuccess:function(){u.current=0},onError:function(){if(u.current+=1,n===-1||u.current<=n){var c=r??Math.min(1e3*Math.pow(2,u.current),3e4);i.current=setTimeout(function(){o.current=!0,t.refresh()},c)}else u.current=0},onCancel:function(){u.current=0,i.current&&clearTimeout(i.current)}}:{}},ye,Be;function zr(){if(Be)return ye;Be=1;var t=Xe(),e=Re(),r="Expected a function";function n(i,u,o){var c=!0,s=!0;if(typeof i!="function")throw new TypeError(r);return e(o)&&(c="leading"in o?!!o.leading:c,s="trailing"in o?!!o.trailing:s),t(i,u,{leading:c,maxWait:u,trailing:s})}return ye=n,ye}var Lr=zr();const Hr=Ve(Lr);var Wr=function(t,e){var r=e.throttleWait,n=e.throttleLeading,i=e.throttleTrailing,u=g.useRef(),o={};return n!==void 0&&(o.leading=n),i!==void 0&&(o.trailing=i),g.useEffect(function(){if(r){var c=t.runAsync.bind(t);return u.current=Hr(function(s){s()},r,o),t.runAsync=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return new Promise(function(d,f){var m;(m=u.current)===null||m===void 0||m.call(u,function(){c.apply(void 0,R([],T(s),!1)).then(d).catch(f)})})},function(){var s;t.runAsync=c,(s=u.current)===null||s===void 0||s.cancel()}}},[r,n,i]),r?{onCancel:function(){var c;(c=u.current)===null||c===void 0||c.cancel()}}:{}},Br=function(t){g.useEffect(function(){t==null||t()},[])},Vr=function(){var t=T(g.useState({}),2),e=t[1];return g.useCallback(function(){return e({})},[])},Gr=function(){function t(e,r,n,i){i===void 0&&(i={}),this.serviceRef=e,this.options=r,this.subscribe=n,this.initState=i,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=y(y(y({},this.state),{loading:!r.manual}),i)}return t.prototype.setState=function(e){e===void 0&&(e={}),this.state=y(y({},this.state),e),this.subscribe()},t.prototype.runPluginHandler=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=this.pluginImpls.map(function(u){var o;return(o=u[e])===null||o===void 0?void 0:o.call.apply(o,R([u],T(r),!1))}).filter(Boolean);return Object.assign.apply(Object,R([{}],T(i),!1))},t.prototype.runAsync=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return or(this,void 0,void 0,function(){var n,i,u,o,c,s,a,d,f,m,v,l,h,j,F,P,O,E,A,w,D;return sr(this,function(C){switch(C.label){case 0:if(this.count+=1,n=this.count,i=this.runPluginHandler("onBefore",e),u=i.stopNow,o=u===void 0?!1:u,c=i.returnNow,s=c===void 0?!1:c,a=re(i,["stopNow","returnNow"]),o)return[2,new Promise(function(){})];if(this.setState(y({loading:!0,params:e},a)),s)return[2,Promise.resolve(a.data)];(h=(l=this.options).onBefore)===null||h===void 0||h.call(l,e),C.label=1;case 1:return C.trys.push([1,3,,4]),d=this.runPluginHandler("onRequest",this.serviceRef.current,e).servicePromise,d||(d=(v=this.serviceRef).current.apply(v,R([],T(e),!1))),[4,d];case 2:return f=C.sent(),n!==this.count?[2,new Promise(function(){})]:(this.setState({data:f,error:void 0,loading:!1}),(F=(j=this.options).onSuccess)===null||F===void 0||F.call(j,f,e),this.runPluginHandler("onSuccess",f,e),(O=(P=this.options).onFinally)===null||O===void 0||O.call(P,e,f,void 0),n===this.count&&this.runPluginHandler("onFinally",e,f,void 0),[2,f]);case 3:if(m=C.sent(),n!==this.count)return[2,new Promise(function(){})];throw this.setState({error:m,loading:!1}),(A=(E=this.options).onError)===null||A===void 0||A.call(E,m,e),this.runPluginHandler("onError",m,e),(D=(w=this.options).onFinally)===null||D===void 0||D.call(w,e,void 0,m),n===this.count&&this.runPluginHandler("onFinally",e,void 0,m),m;case 4:return[2]}})})},t.prototype.run=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];this.runAsync.apply(this,R([],T(r),!1)).catch(function(i){e.options.onError||console.error(i)})},t.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},t.prototype.refresh=function(){this.run.apply(this,R([],T(this.state.params||[]),!1))},t.prototype.refreshAsync=function(){return this.runAsync.apply(this,R([],T(this.state.params||[]),!1))},t.prototype.mutate=function(e){var r=cr(e)?e(this.state.data):e;this.runPluginHandler("onMutate",r),this.setState({data:r})},t}();function Yr(t,e,r){e===void 0&&(e={}),r===void 0&&(r=[]);var n=e.manual,i=n===void 0?!1:n,u=e.ready,o=u===void 0?!0:u,c=re(e,["manual","ready"]),s=y({manual:i,ready:o},c),a=Ue(t),d=Vr(),f=Ye(function(){var m=r.map(function(v){var l;return(l=v==null?void 0:v.onInit)===null||l===void 0?void 0:l.call(v,s)}).filter(Boolean);return new Gr(a,s,d,Object.assign.apply(Object,R([{}],T(m),!1)))},[]);return f.options=s,f.pluginImpls=r.map(function(m){return m(f,s)}),Br(function(){if(!i&&o){var m=f.state.params||e.defaultParams||[];f.run.apply(f,R([],T(m),!1))}}),xe(function(){f.cancel()}),{loading:f.state.loading,data:f.state.data,error:f.state.error,params:f.state.params||[],cancel:k(f.cancel.bind(f)),refresh:k(f.refresh.bind(f)),refreshAsync:k(f.refreshAsync.bind(f)),run:k(f.run.bind(f)),runAsync:k(f.runAsync.bind(f)),mutate:k(f.mutate.bind(f))}}function Ur(t,e,r){return Yr(t,e,R(R([],T([]),!1),[Cr,Fr,kr,Nr,Wr,Ge,gr,qr],!1))}var $r=function(t,e){var r;e===void 0&&(e={});var n=e.defaultPageSize,i=n===void 0?10:n,u=e.defaultCurrent,o=u===void 0?1:u,c=re(e,["defaultPageSize","defaultCurrent"]),s=Ur(t,y({defaultParams:[{current:o,pageSize:i}],refreshDepsAction:function(){F(1)}},c)),a=s.params[0]||{},d=a.current,f=d===void 0?1:d,m=a.pageSize,v=m===void 0?i:m,l=((r=s.data)===null||r===void 0?void 0:r.total)||0,h=g.useMemo(function(){return Math.ceil(l/v)},[v,l]),j=function(O,E){var A=O<=0?1:O,w=E<=0?1:E,D=Math.ceil(l/w);A>D&&(A=Math.max(1,D));var C=T(s.params||[]),N=C[0],W=N===void 0?{}:N,G=C.slice(1);s.run.apply(s,R([y(y({},W),{current:A,pageSize:w})],T(G),!1))},F=function(O){j(O,v)},P=function(O){j(f,O)};return y(y({},s),{pagination:{current:f,pageSize:v,total:l,totalPage:h,onChange:k(j),changeCurrent:k(F),changePageSize:k(P)}})},Kr=function(t,e){var r;e===void 0&&(e={});var n=e.form,i=e.defaultType,u=i===void 0?"simple":i,o=e.defaultParams,c=e.manual,s=c===void 0?!1:c,a=e.refreshDeps,d=a===void 0?[]:a,f=e.ready,m=f===void 0?!0:f,v=re(e,["form","defaultType","defaultParams","manual","refreshDeps","ready"]),l=$r(t,y(y({ready:m,manual:!0},v),{onSuccess:function(){for(var S,b=[],_=0;_<arguments.length;_++)b[_]=arguments[_];C.current=!0,(S=v.onSuccess)===null||S===void 0||S.call.apply(S,R([v],T(b),!1))}})),h=l.params,j=h===void 0?[]:h,F=l.run,P=j[2]||{},O=T(g.useState((P==null?void 0:P.type)||u),2),E=O[0],A=O[1],w=g.useRef({}),D=g.useRef([]),C=g.useRef(!1),N=!!(n!=null&&n.getInternalHooks),W=function(){if(!n)return{};if(N)return n.getFieldsValue(null,function(){return!0});var S=n.getFieldsValue(),b={};return Object.keys(S).forEach(function(_){(!n.getFieldInstance||n.getFieldInstance(_))&&(b[_]=S[_])}),b},G=function(){if(!n)return Promise.resolve({});var S=W(),b=Object.keys(S);return N?n.validateFields(b):new Promise(function(_,L){n.validateFields(b,function(Y,ne){Y?L(Y):_(ne)})})},q=function(){if(n){if(N)return n.setFieldsValue(w.current);var S={};Object.keys(w.current).forEach(function(b){(!n.getFieldInstance||n.getFieldInstance(b))&&(S[b]=w.current[b])}),n.setFieldsValue(S)}},x=function(){var S=W();w.current=y(y({},w.current),S),A(function(b){return b==="simple"?"advance":"simple"})},I=function(S){m&&setTimeout(function(){G().then(function(b){b===void 0&&(b={});var _=S||y(y({pageSize:e.defaultPageSize||10},(j==null?void 0:j[0])||{}),{current:1});if(!n){F(_);return}w.current=y(y({},w.current),b),F(_,b,{allFormData:w.current,type:E})}).catch(function(b){return b})})},z=function(){var S,b;n&&n.resetFields(),I(y(y({},(o==null?void 0:o[0])||{}),{pageSize:e.defaultPageSize||((b=(S=e.defaultParams)===null||S===void 0?void 0:S[0])===null||b===void 0?void 0:b.pageSize)||10,current:1}))},K=function(S){var b,_,L;(b=S==null?void 0:S.preventDefault)===null||b===void 0||b.call(S),I(C.current?void 0:y({pageSize:e.defaultPageSize||((L=(_=e.defaultParams)===null||_===void 0?void 0:_[0])===null||L===void 0?void 0:L.pageSize)||10,current:1},(o==null?void 0:o[0])||{}))},Je=function(S,b,_,L){var Y=T(j||[]),ne=Y[0],Qe=Y.slice(1);F.apply(void 0,R([y(y({},ne),{current:S.current,pageSize:S.pageSize,filters:b,sorter:_,extra:L})],T(Qe),!1))};g.useEffect(function(){if(j.length>0){w.current=(P==null?void 0:P.allFormData)||{},q(),F.apply(void 0,R([],T(j),!1));return}m&&(w.current=(o==null?void 0:o[1])||{},q(),I(o==null?void 0:o[0]))},[]),V(function(){m&&q()},[E]);var X=g.useRef(!1);return X.current=!1,V(function(){!s&&m&&(X.current=!0,n&&n.resetFields(),w.current=(o==null?void 0:o[1])||{},q(),I(o==null?void 0:o[0]))},[m]),V(function(){X.current||m&&(s||(X.current=!0,l.pagination.changeCurrent(1)))},R([],T(d),!1)),y(y({},l),{tableProps:{dataSource:((r=l.data)===null||r===void 0?void 0:r.list)||D.current,loading:l.loading,onChange:k(Je),pagination:{current:l.pagination.current,pageSize:l.pagination.pageSize,total:l.pagination.total}},search:{submit:k(K),type:E,changeType:k(x),reset:k(z)}})};function Xr(t){const[e]=M.useForm(),[r,n]=g.useState(""),[i,u]=g.useState([]),[o,c]=g.useState(),[s,a]=g.useState(!1),d=async()=>{try{const h=await Se.getMenuList({});console.log("res===",h)}catch{}};g.useEffect(()=>{d()},[]);const f=async()=>{e.validateFields().then(async h=>{a(!1)})},m=()=>{a(!1)},v=h=>{n(h==null?void 0:h.edit),a(!0),e.resetFields(),c((h==null?void 0:h.permissionList.checkedKeys)||[])};g.useImperativeHandle(t.mref,()=>({openModal:v}));const l=(h,j)=>{console.log("onCheck",h,j)};return p.jsx(p.Fragment,{children:p.jsx(Te,{title:r==="add"?"新增角色":"编辑角色",width:600,cancelText:"取消",okText:"确定",open:s,onOk:f,onCancel:m,children:p.jsxs(M,{labelAlign:"right",labelCol:{span:4},form:e,children:[p.jsx(M.Item,{label:"角色名称"}),p.jsx(M.Item,{label:"权限",children:p.jsx(Ze,{checkable:!0,defaultExpandAll:!0,onCheck:l,checkedKeys:o,fieldNames:{key:"_id",title:"menuName",children:"children"},treeData:i})})]})})})}const{confirm:Jr}=Te;function at(){const t=g.useRef(null),e=g.useRef(null),[r]=M.useForm(),[n]=g.useState(!1),i=()=>{var v;let m={edit:"add"};(v=t.current)==null||v.openModal(m)},u=m=>{var l;let v={edit:"edit",...m};(l=t.current)==null||l.openModal(v)},o=()=>{},c=[{title:"角色名称",dataIndex:"roleName",key:"_id",width:"20%"},{title:"备注",dataIndex:"remark",key:"_id"},{title:"创建时间",dataIndex:"createTime",key:"_id",render:m=>_e(m).format("YYYY-MM-DD HH:mm:ss")},{title:"更新时间",dataIndex:"updateTime",key:"_id",render:m=>_e(m).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",dataIndex:"action",width:250,render:(m,v)=>p.jsxs("div",{className:ar.action,children:[p.jsx(B,{type:"primary",onClick:()=>o(),children:"权限"}),p.jsx(B,{type:"primary",onClick:()=>u(v),children:"编辑"}),p.jsx(B,{danger:!0,onClick:()=>f(v._id),children:"删除"})]})}],s=async({current:m,pageSize:v},l)=>{try{const h=await Se.getRoleList({...l,pageNum:m,pageSize:v});return{total:h.data.data.page.total,list:h.data.data.list}}catch(h){return console.error("获取角色列表失败",h),{total:0,list:[]}}},{tableProps:a,search:d}=Kr(s,{form:r,defaultPageSize:5}),f=m=>{Jr({title:"是否执行该操作?",icon:p.jsx(tr,{}),content:"删除该角色将无法恢复，请谨慎操作!",okText:"确定",cancelText:"取消",centered:!0,async onOk(){try{(await Se.deleteRole(m)).data.code===200&&(je.success({content:"删除成功"}),d.submit())}catch{}},onCancel(){}})};return p.jsxs("div",{className:"wrap-table",children:[p.jsxs(M,{className:"search-form",layout:"inline",form:r,children:[p.jsx(M.Item,{label:"角色名称",name:"roleName",children:p.jsx(Q,{placeholder:"请输入角色名称"})}),p.jsxs(M.Item,{label:null,children:[p.jsx(B,{type:"primary",htmlType:"submit",onClick:d.submit,children:"查询"}),p.jsx("span",{style:{marginLeft:"10px"},children:p.jsx(B,{type:"primary",htmlType:"submit",onClick:d.reset,children:"重置"})})]})]}),p.jsxs("div",{className:"header",children:[p.jsx("div",{className:"title",children:"角色列表"}),p.jsx("div",{className:"action",children:p.jsx(B,{type:"primary",onClick:()=>i(),children:"新增"})})]}),p.jsx(er,{tip:"加载中...",spinning:n,children:p.jsx(rr,{rowKey:"_id",columns:c,...a})}),p.jsx(ir,{mref:t}),p.jsx(Xr,{mref:e})]})}export{at as default};
